<script>
	const found = {{ foundJsonStr }}
</script>

Username <input type="text" id="username" value="{{ username }}"></input>
<button onclick="search();">Search</button>

<hr>

{% if username %}

	{% if found %}

		wow <b style="color:#070;">{{ found.username }}</b> has games in puzzles , rank <b style="color:#007;">{{ found.rank }}</b> , puzzles <b style="color:#707;">{{ found.num }}</b>
		
		<hr>

		<table cellspacing="5" cellpadding="5" border="1">

		{% for id in found.puzzleIds %}

		<tr>
			<td><a target="_blank" rel="noopener noreferrer" href="https://lichess.org/training/{{ id }}">{{ id }}</a></td>
			<td id="{{ id }}">loading game data ...</td>
		</tr>

		{% endfor %}
			
		</table>

	{% else %}

		meh ... , no games in puzzles for <b style="color:#700;">{{ username }}</b>

	{% endif %}

{% endif %}

<script>
	function search(){
		const username = document.getElementById("username").value
		document.location.href=`/nunjucks/?getpuzzles=${username}`
	}

	const usernameInput = document.getElementById("username")
		usernameInput.addEventListener("keydown", ev => {
		if(ev.keyCode == 13){
			search()
		}
	})

	setTimeout(_ => {
		usernameInput.select()
		usernameInput.focus()
		
		if(found){
			for(let i = 0; i < found.puzzleIds.length; i++){
				setTimeout(_ => {
					const id = found.puzzleIds[i]
					fetch(`/puzzle/?id=${id}`).then(response => response.json().then(blob => {
						const data = blob.data
						const game = data.game
						const players = game.players
						//console.log(blob)
						const playersData = players.map(player => player.name).join(" - ")
						document.getElementById(id).innerHTML = playersData
					}))					
				}, i * 2000)
			}
		}
	}, 100)
</script>